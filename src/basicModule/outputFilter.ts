import { context } from './index.js'

const maxNewlines = 3

export async function outputFilter(text: string) {
  const { options } = context
  // remove excess newlines, concat to one line if above max
  const split = text.split('\n').filter((t) => t !== '')
  const joined = split.length > maxNewlines ? split.join(' ') : split.join('\n')

  let filtered = joined

  for (const word of options.outputWordFilterList) {
    const regex = new RegExp(`${word}`, 'gi')
    filtered = filtered.replace(regex, '****')
  }

  return filtered
}
